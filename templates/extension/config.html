<!-- templates/index.html -->
{% extends 'extension/base.html' %}

{% block content %}

    {{ content|safe }}

    <div id="responseMessage"></div> <!-- Container f端r die Erfolgsanzeige -->

    <div id="userTableContainer"></div> <!-- Container f端r die Tabelle -->

    <form method="POST" action="">
        {{ form.hidden_tag() }}
        <p>
            {{ form.TTL_username.label }}<br>
            {{ form.TTL_username(size=20) }}
        </p>
        <p>
            {{ form.TTL_password_md5.label }}<br>
            {{ form.TTL_password_md5(size=20) }}
        </p>
        <p>
            {{ form.TTL_lock_alias.label }}<br>
            {{ form.TTL_lock_alias(size=20) }}
        </p>
        <p><button type="submit">Submit</button></p>
    </form>

    <script type="text/javascript">

        window.onload = function() {
            if (window.location.hash) {
                // Hash-Parameter extrahieren
                const hash = window.location.hash.substring(1);
                const params = JSON.parse(decodeURIComponent(hash));
                const configurationToken = params.partnerConfigurationToken;

                // Token an Ihr Backend senden (Beispielcode)
                fetch('/extension/fetchconfig', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ configurationToken: configurationToken })
                })
                .then(response => response.json())
                .then(config => {
                    // Hier w端rden Sie Ihre Konfigurationsformular bef端llen
                    console.log('Konfiguration geladen:', config);
                    // Beispiel: document.getElementById('taskList').innerHTML = config.tasks.join(', ');
                    document.querySelector('input[name="TTL_username"]').value = config.TTL_username || '';
                    document.querySelector('input[name="TTL_password_md5"]').value = config.TTL_password_md5 || '';
                    document.querySelector('input[name="TTL_lock_alias"]').value = config.TTL_lock_alias || '';
                })
                .catch(error => {
                    console.error('Fehler beim Laden der Konfiguration:', error);
                });
            }
        };

    </script>

    
    
    


{% endblock %}
