<!-- templates/index.html -->
{% extends 'extension/base.html' %}

{% block content %}

    {{ content|safe }}

    <div id="responseMessage"></div> <!-- Container für die Erfolgsanzeige -->

    <div id="userTableContainer"></div> <!-- Container für die Tabelle -->

    <form id="configForm">
        <p>
            <label for="ttl_user">Username:</label><br>
            <input type="text" id="ttl_user" name="ttl_user">
        </p>
        <p>
            <label for="ttl_pass">Password MD5:</label><br>
            <input type="text" id="ttl_pass" name="ttl_pass">
        </p>
        <p>
            <label for="ttl_alias">Lock Alias:</label><br>
            <input type="text" id="ttl_alias" name="ttl_alias">
        </p>
        <button type="button" id="submitBtn">Submit</button>
    </form>
    
    <script type="text/javascript">
        window.onload = function() {
            if (window.location.hash) {
                // Hash-Parameter extrahieren
                const hash = window.location.hash.substring(1);
                const params = JSON.parse(decodeURIComponent(hash));
                const configurationToken = params.partnerConfigurationToken;
    
                // Token an Ihr Backend senden (Beispielcode)
                fetch('/extension/fetchconfig', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ configurationToken: configurationToken })
                })
                .then(response => response.json())
                .then(data => {
                    // Konfigurationsformular mit den Daten aus der Antwort befüllen
                    console.log('Konfiguration geladen:', data);

                    document.getElementById('responseMessage').innerHTML = 'Erfolg: ' + data.data.ttl_user + " " + data.data.ttl_pass + " " + data.data.ttl_alias + " "  ;

                    document.getElementById('ttl_user').value = data.data.ttl_user || '';
                    document.getElementById('ttl_pass').value = data.data.ttl_pass || '';
                    document.getElementById('ttl_alias').value = data.data.ttl_alias || '';
                })
                .catch(error => {
                    console.error('Fehler beim Laden der Konfiguration:', error);
                });
            }
        };
    </script>
    

    
    
    


{% endblock %}
